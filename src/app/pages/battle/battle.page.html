<ion-content class="battle-background" scroll="false">
  <ion-toolbar class="battle-title">
    <ion-buttons start>
      <gold></gold>
    </ion-buttons>
    <ion-title>Сражение</ion-title>
    <ion-buttons end>
      <button ion-button (click)="openInventory()">
        Инвентарь
      </button>
    </ion-buttons>
  </ion-toolbar>

  <div class="battle-field">
    <target [isShownAbilities]="false"
            [creature]="targetMonter"
            (selectAbility)="selectAbility"
            class="battle-field__target battle-field__target_monster"></target>

    <div class="battle-field__creatures"
         [ngStyle]="{ 'grid-template-columns': 'repeat(' + (creaturesCount + 1) + ', minmax(10vh, auto))' }">
      <ng-container *ngFor="let creature of creaturesOrder">
        <div (click)="selectedCreature(creature.id)"
             [@scaleSelected]="creature.id === selectedCreatureId ? 'selected' : ''"
             class="battle-field__creatures__creature"
             [ngClass]="{ 'battle-field__creatures__creature_selected': creature.id === selectedCreatureId }"
             [ngStyle]="{
                'height': (27 - creaturesCount * 1.5) + 'vh',
                'width': (27 - creaturesCount * 1.5) + 'vh'
              }">
          <creature-info-short [creature]='creature'></creature-info-short>
        </div>
        <div *ngIf="creature.id === lastCreatureInRound"
              class="battle-field__creatures__round"
              [ngStyle]="{
                'height': (27 - creaturesCount * 1.5) + 'vh',
                'width': '8vh'
              }">
          <div class="battle-field__creatures__round__border"></div>
          <div class="battle-field__creatures__round__value"
               [ngClass]="{ 'battle-field__creatures__round__value_big': currentRound > 9 }">{{currentRound}}</div>
        </div>
      </ng-container>
    </div>
    <div class="battle-field__dices">
      <dice-target [dice]='targetHero?.lastDiceTarget'
                    class="battle-field__dices__target-dice"
                    (click)="clickTarget()"></dice-target>
      <dice [dice]='targetHero?.lastDiceValue || 6'
            class="battle-field__dices__value-dice"
            (click)="clickDice()"></dice>
    </div>

    <target [isShownAbilities]="true"
            [creature]="targetHero"
            [selectedAbilityType]="selectedHeroAbilityType"
            (selectAbilityType)="onSelectAbilityType($event)"
            class="battle-field__target battle-field__target_hero"></target>
  </div>

  <div *ngIf="waiting" class="display-blocker"></div>
</ion-content>
